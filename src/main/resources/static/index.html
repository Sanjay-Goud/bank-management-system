<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bank Management System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --bg-dark: #0f172a;
            --bg-darker: #020617;
            --bg-card: #1e293b;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border: #334155;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--bg-darker) 0%, var(--bg-dark) 100%);
            color: var(--text-primary);
            min-height: 100vh;
        }

        /* Auth Pages */
        .auth-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .auth-card {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 40px;
            width: 100%;
            max-width: 450px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            border: 1px solid var(--border);
        }

        .auth-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .auth-header h1 {
            font-size: 32px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .auth-header p {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 12px 16px;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 14px;
            transition: all 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(99, 102, 241, 0.3);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .auth-footer {
            text-align: center;
            margin-top: 20px;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .auth-footer a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
            transition: color 0.3s;
        }

        .auth-footer a:hover {
            color: var(--secondary);
        }

        /* Dashboard Layout */
        .dashboard {
            display: none;
            min-height: 100vh;
        }

        .dashboard.active {
            display: flex;
        }

        .sidebar {
            width: 260px;
            background: var(--bg-card);
            border-right: 1px solid var(--border);
            padding: 20px;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            transition: transform 0.3s;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 30px;
            text-align: center;
        }

        .nav-item {
            padding: 12px 16px;
            margin-bottom: 8px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--text-secondary);
        }

        .nav-item:hover {
            background: var(--bg-dark);
            color: var(--text-primary);
            transform: translateX(5px);
        }

        .nav-item.active {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .main-content {
            margin-left: 260px;
            padding: 20px;
            width: calc(100% - 260px);
        }

        .top-bar {
            background: var(--bg-card);
            border-radius: 15px;
            padding: 20px 30px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid var(--border);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--bg-card);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid var(--border);
            transition: all 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            margin: 10px 0;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .content-card {
            background: var(--bg-card);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 20px;
            font-weight: 600;
        }

        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 8px;
        }

        thead th {
            text-align: left;
            padding: 12px;
            color: var(--text-secondary);
            font-weight: 600;
            font-size: 14px;
        }

        tbody tr {
            background: var(--bg-dark);
            transition: all 0.3s;
        }

        tbody tr:hover {
            transform: scale(1.01);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        tbody td {
            padding: 15px 12px;
            border-top: 1px solid var(--border);
            border-bottom: 1px solid var(--border);
        }

        tbody td:first-child {
            border-left: 1px solid var(--border);
            border-radius: 10px 0 0 10px;
        }

        tbody td:last-child {
            border-right: 1px solid var(--border);
            border-radius: 0 10px 10px 0;
        }

        .badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-success {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
        }

        .badge-danger {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
        }

        .badge-warning {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning);
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 14px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            margin-right: 5px;
        }

        .btn-edit {
            background: var(--primary);
            color: white;
        }

        .btn-delete {
            background: var(--danger);
            color: white;
        }

        .btn-sm:hover {
            transform: scale(1.05);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            border: 1px solid var(--border);
            animation: modalSlide 0.3s ease-out;
        }

        @keyframes modalSlide {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .close-modal {
            cursor: pointer;
            font-size: 24px;
            color: var(--text-secondary);
            transition: color 0.3s;
        }

        .close-modal:hover {
            color: var(--danger);
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .btn-logout {
            background: var(--danger);
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-logout:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(239, 68, 68, 0.3);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        select {
            width: 100%;
            padding: 12px 16px;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 14px;
            cursor: pointer;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .alert-success {
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid var(--success);
            color: var(--success);
        }

        .alert-error {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid var(--danger);
            color: var(--danger);
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                z-index: 100;
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                width: 100%;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            table {
                font-size: 12px;
            }

            #depositWithdrawSection > div {
                grid-template-columns: 1fr !important;
            }
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }
    </style>
</head>
<body>
<!-- Login Page -->
<div id="loginPage" class="auth-container">
    <div class="auth-card">
        <div class="auth-header">
            <h1>🏦 BMS</h1>
            <p>Welcome back! Please login to your account.</p>
        </div>
        <form id="loginForm">
            <div class="form-group">
                <label>Username</label>
                <input type="text" id="loginUsername" required>
            </div>
            <div class="form-group">
                <label>Password</label>
                <input type="password" id="loginPassword" required>
            </div>
            <button type="submit" class="btn btn-primary">Login</button>
        </form>
        <div class="auth-footer">
            Don't have an account? <a href="#" onclick="showSignup()">Sign up</a>
        </div>
        <div id="loginAlert"></div>
    </div>
</div>

<!-- Signup Page -->
<div id="signupPage" class="auth-container" style="display: none;">
    <div class="auth-card">
        <div class="auth-header">
            <h1>🏦 BMS</h1>
            <p>Create your account to get started.</p>
        </div>
        <form id="signupForm">
            <div class="form-group">
                <label>Full Name</label>
                <input type="text" id="signupFullName" required>
            </div>
            <div class="form-group">
                <label>Username</label>
                <input type="text" id="signupUsername" required>
            </div>
            <div class="form-group">
                <label>Email</label>
                <input type="email" id="signupEmail" required>
            </div>
            <div class="form-group">
                <label>Password</label>
                <input type="password" id="signupPassword" required>
            </div>
            <button type="submit" class="btn btn-primary">Sign Up</button>
        </form>
        <div class="auth-footer">
            Already have an account? <a href="#" onclick="showLogin()">Login</a>
        </div>
        <div id="signupAlert"></div>
    </div>
</div>

<!-- Dashboard -->
<div id="dashboard" class="dashboard">
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="logo">🏦 BMS</div>
        <div class="nav-item active" onclick="showSection('overview')">📊 Overview</div>
        <div class="nav-item" onclick="showSection('accounts')">💳 Accounts</div>
        <div class="nav-item" onclick="showSection('transactions')">💸 Transactions</div>
        <div class="nav-item" onclick="showSection('transfer')">🔄 Transfer</div>
        <div class="nav-item" onclick="showSection('depositWithdraw')">💰 Deposit/Withdraw</div>
        <div class="nav-item" onclick="showSection('statistics')">📈 Statistics</div>
        <div class="nav-item" onclick="showSection('profile')">👤 Profile</div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Top Bar -->
        <div class="top-bar">
            <div>
                <h2 id="sectionTitle">Dashboard Overview</h2>
            </div>
            <div class="user-info">
                <div>
                    <div style="font-weight: 600;" id="userName">Loading...</div>
                    <div style="font-size: 12px; color: var(--text-secondary);" id="userRole">USER</div>
                </div>
                <div class="user-avatar" id="userAvatar">U</div>
                <button class="btn-logout" onclick="logout()">Logout</button>
            </div>
        </div>

        <!-- Overview Section -->
        <div id="overviewSection" class="section active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Total Accounts</div>
                    <div class="stat-value" id="totalAccounts">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Total Balance</div>
                    <div class="stat-value" id="totalBalance">$0.00</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Today's Transactions</div>
                    <div class="stat-value" id="todayTransactions">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Active Accounts</div>
                    <div class="stat-value" id="activeAccounts">0</div>
                </div>
            </div>

            <div class="content-card">
                <div class="card-header">
                    <h3 class="card-title">Recent Transactions</h3>
                </div>
                <div id="recentTransactionsTable"></div>
            </div>
        </div>

        <!-- Accounts Section -->
        <div id="accountsSection" class="section">
            <div class="content-card">
                <div class="card-header">
                    <h3 class="card-title">All Accounts</h3>
                    <button class="btn btn-primary" onclick="openAccountModal()">+ New Account</button>
                </div>
                <div id="accountsTable"></div>
            </div>
        </div>

        <!-- Transactions Section -->
        <div id="transactionsSection" class="section">
            <div class="content-card">
                <div class="card-header">
                    <h3 class="card-title">All Transactions</h3>
                </div>
                <div id="allTransactionsTable"></div>
            </div>
        </div>

        <!-- Transfer Section -->
        <div id="transferSection" class="section">
            <div class="content-card">
                <div class="card-header">
                    <h3 class="card-title">Transfer Funds</h3>
                </div>
                <form id="transferForm">
                    <div class="form-group">
                        <label>From Account Number</label>
                        <input type="text" id="fromAccount" required>
                    </div>
                    <div class="form-group">
                        <label>To Account Number</label>
                        <input type="text" id="toAccount" required>
                    </div>
                    <div class="form-group">
                        <label>Amount</label>
                        <input type="number" step="0.01" id="transferAmount" required>
                    </div>
                    <div class="form-group">
                        <label>Description (Optional)</label>
                        <input type="text" id="transferDescription">
                    </div>
                    <button type="submit" class="btn btn-primary">Transfer</button>
                </form>
                <div id="transferAlert"></div>
            </div>
        </div>

        <!-- Deposit/Withdraw Section -->
        <div id="depositWithdrawSection" class="section">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <!-- Deposit Card -->
                <div class="content-card">
                    <div class="card-header">
                        <h3 class="card-title">💰 Deposit</h3>
                    </div>
                    <form id="depositForm">
                        <div class="form-group">
                            <label>Select Account</label>
                            <select id="depositAccountId" required>
                                <option value="">Select an account...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Amount</label>
                            <input type="number" step="0.01" id="depositAmount" min="0.01" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Deposit</button>
                    </form>
                    <div id="depositAlert"></div>
                </div>

                <!-- Withdraw Card -->
                <div class="content-card">
                    <div class="card-header">
                        <h3 class="card-title">💸 Withdraw</h3>
                    </div>
                    <form id="withdrawForm">
                        <div class="form-group">
                            <label>Select Account</label>
                            <select id="withdrawAccountId" required>
                                <option value="">Select an account...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Amount</label>
                            <input type="number" step="0.01" id="withdrawAmount" min="0.01" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Withdraw</button>
                    </form>
                    <div id="withdrawAlert"></div>
                </div>
            </div>
        </div>

        <!-- Statistics Section -->
        <div id="statisticsSection" class="section">
            <div class="content-card">
                <div class="card-header">
                    <h3 class="card-title">Account Statistics</h3>
                    <button class="btn btn-primary" onclick="loadStatistics()">Refresh</button>
                </div>
                <div id="statisticsContent"></div>
            </div>
        </div>

        <!-- Profile Section -->
        <div id="profileSection" class="section">
            <div class="content-card">
                <div class="card-header">
                    <h3 class="card-title">User Profile</h3>
                </div>
                <div id="profileContent"></div>
            </div>
        </div>
    </div>
</div>

<!-- Account Modal -->
<div id="accountModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="accountModalTitle">Create Account</h3>
            <span class="close-modal" onclick="closeAccountModal()">×</span>
        </div>
        <form id="accountForm">
            <input type="hidden" id="accountId">
            <div class="form-group">
                <label>Account Number</label>
                <input type="text" id="accountNumber" required>
            </div>
            <div class="form-group">
                <label>Account Holder Name</label>
                <input type="text" id="accountHolderName" required>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Account Type</label>
                    <select id="accountType" required>
                        <option value="Savings">Savings</option>
                        <option value="Current">Current</option>
                        <option value="Fixed">Fixed Deposit</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Status</label>
                    <select id="accountStatus" required>
                        <option value="Active">Active</option>
                        <option value="Inactive">Inactive</option>
                        <option value="Frozen">Frozen</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label>Initial Balance</label>
                <input type="number" step="0.01" id="accountBalance" required>
            </div>
            <button type="submit" class="btn btn-primary">Save Account</button>
        </form>
    </div>
</div>

<script>
    const API_BASE = 'http://localhost:8080/api';
    let token = localStorage.getItem('token');
    let currentUser = null;

    // Auth Functions
    document.getElementById('loginForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const username = document.getElementById('loginUsername').value;
        const password = document.getElementById('loginPassword').value;

        try {
            const res = await fetch(`${API_BASE}/auth/login`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, password })
            });

            const data = await res.json();
            if (res.ok) {
                token = data.token;
                localStorage.setItem('token', token);
                currentUser = data.user;
                showDashboard();
            } else {
                showAlert('loginAlert', data.message || 'Login failed', 'error');
            }
        } catch (err) {
            showAlert('loginAlert', 'Error: ' + err.message, 'error');
        }
    });

    document.getElementById('signupForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const fullName = document.getElementById('signupFullName').value;
        const username = document.getElementById('signupUsername').value;
        const email = document.getElementById('signupEmail').value;
        const password = document.getElementById('signupPassword').value;

        try {
            const res = await fetch(`${API_BASE}/auth/register`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ fullName, username, email, password })
            });

            const data = await res.json();
            if (res.ok) {
                token = data.token;
                localStorage.setItem('token', token);
                currentUser = data.user;
                showDashboard();
            } else {
                showAlert('signupAlert', data.message || 'Signup failed', 'error');
            }
        } catch (err) {
            showAlert('signupAlert', 'Error: ' + err.message, 'error');
        }
    });

    function showLogin() {
        document.getElementById('signupPage').style.display = 'none';
        document.getElementById('loginPage').style.display = 'flex';
    }

    function showSignup() {
        document.getElementById('loginPage').style.display = 'none';
        document.getElementById('signupPage').style.display = 'flex';
    }

    function showDashboard() {
        document.getElementById('loginPage').style.display = 'none';
        document.getElementById('signupPage').style.display = 'none';
        document.getElementById('dashboard').classList.add('active');
        loadDashboardData();
    }

    function logout() {
        localStorage.removeItem('token');
        token = null;
        currentUser = null;
        location.reload();
    }

    async function loadDashboardData() {
        if (currentUser) {
            document.getElementById('userName').textContent = currentUser.fullName;
            document.getElementById('userRole').textContent = currentUser.role;
            document.getElementById('userAvatar').textContent = currentUser.fullName.charAt(0).toUpperCase();
        }

        await Promise.all([
            loadOverviewStats(),
            loadRecentTransactions(),
            loadAccounts()
        ]);
    }

    async function loadOverviewStats() {
        try {
            const [accountsRes, statsRes, transRes] = await Promise.all([
                fetch(`${API_BASE}/accounts/count`, { headers: { 'Authorization': `Bearer ${token}` }}),
                fetch(`${API_BASE}/statistics/accounts`, { headers: { 'Authorization': `Bearer ${token}` }}),
                fetch(`${API_BASE}/transactions/today/count`, { headers: { 'Authorization': `Bearer ${token}` }})
            ]);

            const accountsData = await accountsRes.json();
            const statsData = await statsRes.json();
            const transData = await transRes.json();

            document.getElementById('totalAccounts').textContent = accountsData.totalAccounts || 0;
            document.getElementById('totalBalance').textContent = `$${(statsData.totalBalance || 0).toFixed(2)}`;
            document.getElementById('todayTransactions').textContent = transData || 0;
            document.getElementById('activeAccounts').textContent = statsData.activeAccounts || 0;
        } catch (err) {
            console.error('Error loading stats:', err);
        }
    }

    async function loadRecentTransactions() {
        try {
            const res = await fetch(`${API_BASE}/transactions/recent?limit=10`, {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            const data = await res.json();
            renderTransactions(data, 'recentTransactionsTable');
        } catch (err) {
            console.error('Error loading transactions:', err);
        }
    }

    async function loadAccounts() {
        try {
            const res = await fetch(`${API_BASE}/accounts`, {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            const data = await res.json();
            renderAccounts(data);
        } catch (err) {
            console.error('Error loading accounts:', err);
        }
    }

    function renderAccounts(accounts) {
        const html = accounts.length === 0 ?
            '<div class="empty-state"><div class="empty-state-icon">📭</div><p>No accounts found</p></div>' :
            `<table>
                <thead>
                    <tr>
                        <th>Account #</th>
                        <th>Holder Name</th>
                        <th>Type</th>
                        <th>Balance</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    ${accounts.map(acc => `
                        <tr>
                            <td>${acc.accountNumber}</td>
                            <td>${acc.accountHolderName}</td>
                            <td>${acc.accountType}</td>
                            <td>${parseFloat(acc.balance).toFixed(2)}</td>
                            <td><span class="badge badge-${acc.accountStatus === 'Active' ? 'success' : acc.accountStatus === 'Frozen' ? 'danger' : 'warning'}">${acc.accountStatus}</span></td>
                            <td>
                                <button class="btn-sm btn-edit" onclick="editAccount(${acc.id})">Edit</button>
                                <button class="btn-sm btn-delete" onclick="deleteAccount(${acc.id})">Delete</button>
                            </td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>`;
        document.getElementById('accountsTable').innerHTML = html;
    }

    function renderTransactions(transactions, containerId) {
        const html = transactions.length === 0 ?
            '<div class="empty-state"><div class="empty-state-icon">📋</div><p>No transactions found</p></div>' :
            `<table>
                <thead>
                    <tr>
                        <th>Reference</th>
                        <th>Type</th>
                        <th>Amount</th>
                        <th>Balance After</th>
                        <th>Date</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    ${transactions.map(t => `
                        <tr>
                            <td>${t.referenceNumber || 'N/A'}</td>
                            <td>${t.transactionType}</td>
                            <td>${parseFloat(t.amount).toFixed(2)}</td>
                            <td>${parseFloat(t.balanceAfter).toFixed(2)}</td>
                            <td>${new Date(t.transactionDate).toLocaleString()}</td>
                            <td><span class="badge badge-${t.status === 'SUCCESS' ? 'success' : t.status === 'FAILED' ? 'danger' : 'warning'}">${t.status}</span></td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>`;
        document.getElementById(containerId).innerHTML = html;
    }

    function showSection(section) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));

        const sectionMap = {
            overview: { el: 'overviewSection', title: 'Dashboard Overview' },
            accounts: { el: 'accountsSection', title: 'Account Management' },
            transactions: { el: 'transactionsSection', title: 'Transaction History' },
            transfer: { el: 'transferSection', title: 'Transfer Funds' },
            depositWithdraw: { el: 'depositWithdrawSection', title: 'Deposit & Withdraw' },
            statistics: { el: 'statisticsSection', title: 'Statistics & Analytics' },
            profile: { el: 'profileSection', title: 'User Profile' }
        };

        const current = sectionMap[section];
        document.getElementById(current.el).classList.add('active');
        document.getElementById('sectionTitle').textContent = current.title;
        event.target.classList.add('active');

        if (section === 'transactions') loadAllTransactions();
        if (section === 'statistics') loadStatistics();
        if (section === 'profile') loadProfile();
        if (section === 'depositWithdraw') loadAccountsForDepositWithdraw();
    }

    async function loadAllTransactions() {
        try {
            const res = await fetch(`${API_BASE}/transactions`, {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            const data = await res.json();
            renderTransactions(data, 'allTransactionsTable');
        } catch (err) {
            console.error('Error loading transactions:', err);
        }
    }

    async function loadStatistics() {
        try {
            const res = await fetch(`${API_BASE}/statistics/accounts`, {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            const data = await res.json();

            const html = `
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Total Accounts</div>
                        <div class="stat-value">${data.totalAccounts}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total Balance</div>
                        <div class="stat-value">${parseFloat(data.totalBalance).toFixed(2)}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Average Balance</div>
                        <div class="stat-value">${parseFloat(data.averageBalance).toFixed(2)}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Max Balance</div>
                        <div class="stat-value">${parseFloat(data.maxBalance).toFixed(2)}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Active Accounts</div>
                        <div class="stat-value">${data.activeAccounts}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Inactive Accounts</div>
                        <div class="stat-value">${data.inactiveAccounts}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Frozen Accounts</div>
                        <div class="stat-value">${data.frozenAccounts}</div>
                    </div>
                </div>
                <div style="margin-top: 30px;">
                    <h4 style="margin-bottom: 15px;">Account Type Distribution</h4>
                    ${Object.entries(data.accountTypeDistribution || {}).map(([type, count]) => `
                        <div style="margin-bottom: 10px; display: flex; justify-content: space-between; padding: 15px; background: var(--bg-dark); border-radius: 10px;">
                            <span>${type}</span>
                            <span style="font-weight: bold;">${count} accounts</span>
                        </div>
                    `).join('')}
                </div>
            `;
            document.getElementById('statisticsContent').innerHTML = html;
        } catch (err) {
            console.error('Error loading statistics:', err);
        }
    }

    function loadProfile() {
        if (currentUser) {
            const html = `
                <div style="max-width: 600px;">
                    <div style="text-align: center; margin-bottom: 30px;">
                        <div style="width: 100px; height: 100px; border-radius: 50%; background: linear-gradient(135deg, var(--primary), var(--secondary)); display: flex; align-items: center; justify-content: center; font-size: 40px; margin: 0 auto 20px; font-weight: bold;">
                            ${currentUser.fullName.charAt(0).toUpperCase()}
                        </div>
                        <h2>${currentUser.fullName}</h2>
                        <p style="color: var(--text-secondary);">@${currentUser.username}</p>
                    </div>
                    <div style="background: var(--bg-dark); padding: 20px; border-radius: 15px; margin-bottom: 15px;">
                        <div style="color: var(--text-secondary); font-size: 14px;">Email</div>
                        <div style="font-size: 16px; margin-top: 5px;">${currentUser.email}</div>
                    </div>
                    <div style="background: var(--bg-dark); padding: 20px; border-radius: 15px; margin-bottom: 15px;">
                        <div style="color: var(--text-secondary); font-size: 14px;">Role</div>
                        <div style="font-size: 16px; margin-top: 5px;">${currentUser.role}</div>
                    </div>
                    <div style="background: var(--bg-dark); padding: 20px; border-radius: 15px; margin-bottom: 15px;">
                        <div style="color: var(--text-secondary); font-size: 14px;">Member Since</div>
                        <div style="font-size: 16px; margin-top: 5px;">${new Date(currentUser.createdAt).toLocaleDateString()}</div>
                    </div>
                    ${currentUser.lastLogin ? `
                    <div style="background: var(--bg-dark); padding: 20px; border-radius: 15px;">
                        <div style="color: var(--text-secondary); font-size: 14px;">Last Login</div>
                        <div style="font-size: 16px; margin-top: 5px;">${new Date(currentUser.lastLogin).toLocaleString()}</div>
                    </div>
                    ` : ''}
                </div>
            `;
            document.getElementById('profileContent').innerHTML = html;
        }
    }

    // Account Modal Functions
    function openAccountModal(accountId = null) {
        document.getElementById('accountModal').classList.add('active');
        document.getElementById('accountForm').reset();
        document.getElementById('accountId').value = '';

        if (accountId) {
            document.getElementById('accountModalTitle').textContent = 'Edit Account';
            loadAccountDetails(accountId);
        } else {
            document.getElementById('accountModalTitle').textContent = 'Create Account';
        }
    }

    function closeAccountModal() {
        document.getElementById('accountModal').classList.remove('active');
    }

    async function loadAccountDetails(id) {
        try {
            const res = await fetch(`${API_BASE}/accounts/id/${id}`, {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            const data = await res.json();

            document.getElementById('accountId').value = data.id;
            document.getElementById('accountNumber').value = data.accountNumber;
            document.getElementById('accountHolderName').value = data.accountHolderName;
            document.getElementById('accountType').value = data.accountType;
            document.getElementById('accountStatus').value = data.accountStatus;
            document.getElementById('accountBalance').value = data.balance;
        } catch (err) {
            console.error('Error loading account:', err);
        }
    }

    document.getElementById('accountForm').addEventListener('submit', async (e) => {
        e.preventDefault();

        const accountData = {
            id: document.getElementById('accountId').value || null,
            accountNumber: document.getElementById('accountNumber').value,
            accountHolderName: document.getElementById('accountHolderName').value,
            accountType: document.getElementById('accountType').value,
            accountStatus: document.getElementById('accountStatus').value,
            balance: parseFloat(document.getElementById('accountBalance').value)
        };

        try {
            const url = accountData.id ?
                `${API_BASE}/accounts/id/${accountData.id}` :
                `${API_BASE}/accounts`;
            const method = accountData.id ? 'PUT' : 'POST';

            const res = await fetch(url, {
                method,
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify(accountData)
            });

            if (res.ok) {
                closeAccountModal();
                loadAccounts();
                loadOverviewStats();
            } else {
                alert('Error saving account');
            }
        } catch (err) {
            console.error('Error saving account:', err);
            alert('Error: ' + err.message);
        }
    });

    async function editAccount(id) {
        openAccountModal(id);
    }

    async function deleteAccount(id) {
        if (!confirm('Are you sure you want to delete this account?')) return;

        try {
            const res = await fetch(`${API_BASE}/accounts/id/${id}`, {
                method: 'DELETE',
                headers: { 'Authorization': `Bearer ${token}` }
            });

            if (res.ok) {
                loadAccounts();
                loadOverviewStats();
            } else {
                alert('Error deleting account');
            }
        } catch (err) {
            console.error('Error deleting account:', err);
        }
    }

    // Transfer Form
    document.getElementById('transferForm').addEventListener('submit', async (e) => {
        e.preventDefault();

        const transferData = {
            fromAccountNumber: document.getElementById('fromAccount').value,
            toAccountNumber: document.getElementById('toAccount').value,
            amount: parseFloat(document.getElementById('transferAmount').value),
            description: document.getElementById('transferDescription').value
        };

        try {
            const res = await fetch(`${API_BASE}/transactions/transfer`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify(transferData)
            });

            const data = await res.json();

            if (res.ok) {
                showAlert('transferAlert', 'Transfer completed successfully!', 'success');
                document.getElementById('transferForm').reset();
                loadOverviewStats();
            } else {
                showAlert('transferAlert', data.message || 'Transfer failed', 'error');
            }
        } catch (err) {
            showAlert('transferAlert', 'Error: ' + err.message, 'error');
        }
    });

    function showAlert(containerId, message, type) {
        const container = document.getElementById(containerId);
        container.innerHTML = `<div class="alert alert-${type === 'error' ? 'error' : 'success'}">${message}</div>`;
        setTimeout(() => container.innerHTML = '', 5000);
    }

    // Deposit and Withdraw Functions
    async function loadAccountsForDepositWithdraw() {
        try {
            const res = await fetch(`${API_BASE}/accounts`, {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            const accounts = await res.json();

            const options = accounts
                .filter(acc => acc.accountStatus === 'Active')
                .map(acc => `<option value="${acc.id}">${acc.accountNumber} - ${acc.accountHolderName} (${parseFloat(acc.balance).toFixed(2)})</option>`)
                .join('');

            document.getElementById('depositAccountId').innerHTML = '<option value="">Select an account...</option>' + options;
            document.getElementById('withdrawAccountId').innerHTML = '<option value="">Select an account...</option>' + options;
        } catch (err) {
            console.error('Error loading accounts:', err);
        }
    }

    document.getElementById('depositForm').addEventListener('submit', async (e) => {
        e.preventDefault();

        const accountId = document.getElementById('depositAccountId').value;
        const amount = parseFloat(document.getElementById('depositAmount').value);

        try {
            const res = await fetch(`${API_BASE}/accounts/id/${accountId}/deposit`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({ amount })
            });

            const data = await res.json();

            if (res.ok) {
                showAlert('depositAlert', `Successfully deposited ${amount.toFixed(2)}. New balance: ${parseFloat(data.balance).toFixed(2)}`, 'success');
                document.getElementById('depositForm').reset();
                loadOverviewStats();
                loadAccountsForDepositWithdraw();
            } else {
                showAlert('depositAlert', data.message || 'Deposit failed', 'error');
            }
        } catch (err) {
            showAlert('depositAlert', 'Error: ' + err.message, 'error');
        }
    });

    document.getElementById('withdrawForm').addEventListener('submit', async (e) => {
        e.preventDefault();

        const accountId = document.getElementById('withdrawAccountId').value;
        const amount = parseFloat(document.getElementById('withdrawAmount').value);

        try {
            const res = await fetch(`${API_BASE}/accounts/id/${accountId}/withdraw`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({ amount })
            });

            const data = await res.json();

            if (res.ok) {
                showAlert('withdrawAlert', `Successfully withdrew ${amount.toFixed(2)}. New balance: ${parseFloat(data.balance).toFixed(2)}`, 'success');
                document.getElementById('withdrawForm').reset();
                loadOverviewStats();
                loadAccountsForDepositWithdraw();
            } else {
                showAlert('withdrawAlert', data.message || 'Withdrawal failed', 'error');
            }
        } catch (err) {
            showAlert('withdrawAlert', 'Error: ' + err.message, 'error');
        }
    });

    // Initialize
    if (token) {
        fetch(`${API_BASE}/auth/me`, {
            headers: { 'Authorization': `Bearer ${token}` }
        })
        .then(res => res.json())
        .then(data => {
            currentUser = data;
            showDashboard();
        })
        .catch(() => {
            localStorage.removeItem('token');
            token = null;
        });
    }
</script>
</body>
</html>